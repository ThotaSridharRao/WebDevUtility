<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Utility Tools - PDF Toolkit</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">
    <style>
        /* Define CSS Variables for the default (dark) theme */
        :root {
            --primary-color: #1abc9c; /* Dark mode primary green */
            --secondary-color: #2ecc71; /* Dark mode secondary green */
            --accent-color: #3498db; /* Dark mode accent blue */
            --bg-color: #2c3e50; /* Dark mode background */
            --header-bg: #34495e; /* Dark mode header */
            --card-bg: #3b506b; /* Dark mode card */
            --text-color: #ecf0f1; /* Dark mode text */
            --button-bg: #1abc9c; /* Dark mode button */
            --button-text: #FFFFFF;
            --border-color: #5a708a; /* Dark mode border */
            --shadow-color: rgba(0, 0, 0, 0.3); /* Dark mode shadow */
        }

        /* General Styles */
        body {
            font-family: 'DM Sans', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .container {
            max-width: 1440px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background-color: var(--header-bg);
            padding: 20px 0;
            box-shadow: 0px 4px 12px var(--shadow-color);
            transition: background-color 0.3s, box-shadow 0.3s;
            position: relative;
        }

        header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 24px;
            font-weight: 700;
            color: var(--text-color);
            text-decoration: none;
            transition: color 0.3s;
        }

        nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
        }

        nav ul li {
            margin-left: 30px;
        }

        nav ul li a {
            text-decoration: none;
            color: var(--text-color);
            font-weight: 500;
            transition: color 0.3s;
        }

        .primary-button {
            background-color: var(--primary-color);
            color: var(--button-text);
            border: none;
            padding: 15px 30px;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 18px;
            font-weight: 700;
            box-shadow: 0px 4px 12px var(--shadow-color);
            transition: background-color 0.3s, color 0.3s, box-shadow 0.3s;
        }

        .primary-button:disabled {
            background-color: var(--border-color);
            cursor: not-allowed;
        }

        main {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px 0;
        }

        .tool-card {
            background-color: var(--card-bg);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0px 4px 12px var(--shadow-color);
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }

        .tool-card h1, .tool-card h2 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 36px;
            margin-bottom: 10px;
            color: var(--text-color);
        }

        .tool-card p {
            font-size: 18px;
            margin-bottom: 30px;
            color: var(--text-color);
        }

        /* Tool Selector */
        #tool-selector-container {
            margin-bottom: 30px;
        }

        #pdf-tool-selector {
            padding: 12px 20px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            background-color: var(--card-bg);
            color: var(--text-color);
            font-family: 'DM Sans', sans-serif;
            font-size: 16px;
            width: 100%;
            max-width: 400px;
            cursor: pointer;
            outline: none;
            box-shadow: 0px 2px 8px rgba(0, 0, 0, 0.2);
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        #pdf-tool-selector:focus {
            border-color: var(--primary-color);
            box-shadow: 0px 0px 0px 3px rgba(26, 188, 156, 0.4);
        }

        /* Common Tool UI Elements */
        .drag-drop-area {
            border: 2px dashed var(--border-color);
            border-radius: 20px;
            padding: 60px;
            text-align: center;
            margin-bottom: 20px;
            transition: border-color 0.3s, background-color 0.3s;
            cursor: pointer;
        }

        .drag-drop-area.dragover {
            background-color: var(--bg-color);
            border-color: var(--button-bg);
        }

        .drag-drop-area p {
            margin: 0 0 15px 0;
            color: var(--text-color);
        }

        .browse-button {
            background-color: var(--secondary-color);
            color: var(--button-text);
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 700;
            box-shadow: 0px 2px 8px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s, box-shadow 0.3s;
        }

        .browse-button:hover {
            background-color: var(--primary-color);
        }

        .uploaded-files-list {
            list-style: none;
            padding: 0;
            margin-top: 20px;
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            background-color: var(--bg-color);
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-color);
            cursor: grab;
            transition: background-color 0.2s;
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .file-item:hover {
            background-color: var(--header-bg);
        }

        .file-item.dragging {
            opacity: 0.5;
            border: 2px dashed var(--primary-color);
        }

        .file-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            flex-grow: 1;
            margin-right: 10px;
        }

        .file-info .name {
            font-weight: 500;
            word-break: break-all;
        }

        .file-info .size {
            font-size: 0.8em;
            color: var(--text-color);
            opacity: 0.7;
        }

        .remove-file-btn {
            background-color: #e74c3c;
            color: var(--button-text);
            border: none;
            padding: 8px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s;
        }

        .remove-file-btn:hover {
            background-color: #c0392b;
        }

        .tool-buttons-container { /* Renamed from merge-button-container for generality */
            margin-top: 30px;
            text-align: center;
        }

        /* Loader/Spinner */
        .loader {
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results-section {
            margin-top: 30px;
            text-align: center;
        }

        .download-link {
            display: inline-block;
            background-color: var(--primary-color);
            color: var(--button-text);
            padding: 15px 30px;
            border-radius: 20px;
            text-decoration: none;
            font-weight: 700;
            margin-top: 20px;
            box-shadow: 0px 4px 12px var(--shadow-color);
            transition: background-color 0.3s, box-shadow 0.3s;
        }

        .download-link:hover {
            background-color: var(--secondary-color);
        }

        /* Message Box Styles */
        .message-box {
            background-color: var(--accent-color);
            color: var(--text-color);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 500;
            text-align: center;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Hamburger Menu Styles */
        .hamburger-menu {
            display: none;
            flex-direction: column;
            cursor: pointer;
            padding: 10px;
            z-index: 1001;
        }

        .hamburger-menu .bar {
            width: 25px;
            height: 3px;
            background-color: var(--text-color);
            margin: 4px 0;
            transition: 0.4s;
        }

        /* Floating Nav Menu */
        .floating-nav {
            display: none;
            position: absolute;
            top: 100%;
            right: 20px;
            background-color: var(--header-bg);
            box-shadow: 0px 8px 16px var(--shadow-color);
            border-radius: 8px;
            overflow: hidden;
            z-index: 1000;
            min-width: 180px;
            padding: 10px 0;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.3s ease-out, transform 0.3s ease-out;
        }

        .floating-nav.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .floating-nav ul {
            flex-direction: column;
            padding: 0;
            margin: 0;
        }

        .floating-nav ul li {
            margin: 0;
            width: 100%;
        }

        .floating-nav ul li a {
            padding: 10px 20px;
            display: block;
            color: var(--text-color);
            text-align: left;
            text-decoration: none;
            transition: background-color 0.2s;
        }

        .floating-nav ul li a:hover {
            background-color: var(--card-bg);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            header .container {
                flex-direction: row;
                justify-content: space-between;
            }

            nav {
                display: none;
            }

            .hamburger-menu {
                display: flex;
            }

            .cta-button {
                display: none;
            }

            .tool-card {
                padding: 20px;
            }

            .tool-card h1 {
                font-size: 28px;
            }

            .drag-drop-area {
                padding: 40px;
            }

            .file-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .file-info {
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <a href="index.html" class="logo">Utility Tools</a>
            <nav id="main-nav">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="#" id="tools-main-nav-link">Tools</a></li>
                </ul>
            </nav>
            <div class="hamburger-menu" id="hamburger-menu">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
            <div class="floating-nav" id="floating-nav">
                <ul>
                    <li><a href="image_convertor.html">Image Converter</a></li>
                    <li><a href="video_convertor.html">Video Converter</a></li>
                    <li><a href="webm_video_viewer.html">Video Player</a></li>
                    <li><a href="color_palette_generator.html">Color Palette Generator</a></li>
                    <li><a href="#" data-tool="merge">PDF Merge Tool</a></li>
                    <li><a href="#" data-tool="split">Split PDF</a></li>
                    <li><a href="#" data-tool="compress">Compress PDF</a></li>
                    <li><a href="#" data-tool="img2pdf">Images to PDF</a></li>
                    <li><a href="#" data-tool="pdf2img">PDF to Images</a></li>
                </ul>
            </div>
        </div>
    </header>

    <main>
        <div class="tool-card">
            <div id="tool-selector-container">
                <h1>PDF Toolkit</h1>
                <p>Select a tool to get started.</p>
                <select id="pdf-tool-selector">
                    <option value="">Choose a PDF Tool</option>
                    <option value="merge">Merge PDFs</option>
                    <option value="split">Split PDF by Page Range</option>
                    <option value="compress">Compress PDF</option>
                    <option value="img2pdf">Convert Images to PDF</option>
                    <option value="pdf2img">Convert PDF to Images</option>
                </select>
            </div>

            <div id="message-container"></div>
            <div id="tool-ui-container">
                <!-- Tool-specific UI will be loaded here -->
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-links">
                <a href="#">Terms</a>
                <a href="#">Privacy</a>
                <a href="#">GitHub</a>
                <a href="#">LinkedIn</a>
            </div>
            <p>Built by developers, for developers.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const hamburgerMenu = document.getElementById('hamburger-menu');
            const floatingNav = document.getElementById('floating-nav');
            const mainNav = document.getElementById('main-nav');
            const toolsMainNavLink = document.getElementById('tools-main-nav-link');

            const pdfToolSelector = document.getElementById('pdf-tool-selector');
            const toolUiContainer = document.getElementById('tool-ui-container');
            const messageContainer = document.getElementById('message-container');
            const toolSelectorContainer = document.getElementById('tool-selector-container');

            // --- Common Helper Functions ---
            function formatBytes(bytes, decimals = 2) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const dm = decimals < 0 ? 0 : decimals;
                const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
            }

            function showMessage(message, type = 'info') {
                messageContainer.innerHTML = `<div class="message-box ${type}">${message}</div>`;
                setTimeout(() => {
                    messageContainer.innerHTML = '';
                }, 5000);
            }

            function showLoader(show) {
                const loader = document.getElementById('loader');
                if (loader) {
                    loader.style.display = show ? 'block' : 'none';
                }
            }

            function showResults(blob, filename, type = 'application/pdf') {
                toolUiContainer.innerHTML = `
                    <div class="results-section">
                        <h2>Success!</h2>
                        <a href="${URL.createObjectURL(blob)}" id="download-result-link" class="download-link" download="${filename}">Download ${filename}</a>
                        <button class="primary-button" id="reset-tool-btn" style="margin-top: 20px;">Start Over</button>
                    </div>
                `;
                document.getElementById('reset-tool-btn').addEventListener('click', resetToolUI);
                document.getElementById('download-result-link').addEventListener('click', (e) => {
                    // Revoke URL after download is initiated
                    setTimeout(() => URL.revokeObjectURL(e.target.href), 100);
                });
            }

            function resetToolUI() {
                toolUiContainer.innerHTML = '';
                messageContainer.innerHTML = '';
                pdfToolSelector.value = ''; // Reset selector
                toolSelectorContainer.style.display = 'block'; // Show tool selector
            }

            // --- Header Navigation Logic ---
            hamburgerMenu.addEventListener('click', (event) => {
                event.stopPropagation();
                floatingNav.classList.toggle('active');
            });

            if (toolsMainNavLink) {
                toolsMainNavLink.addEventListener('click', (event) => {
                    event.preventDefault();
                    event.stopPropagation();
                    floatingNav.classList.toggle('active');
                });
            }

            floatingNav.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                    floatingNav.classList.remove('active');
                });
            });

            document.addEventListener('click', (event) => {
                const isClickInsideHamburger = hamburgerMenu.contains(event.target);
                const isClickInsideToolsLink = toolsMainNavLink && toolsMainNavLink.contains(event.target);
                const isClickInsideFloatingNav = floatingNav.contains(event.target);

                if (!isClickInsideHamburger && !isClickInsideToolsLink && !isClickInsideFloatingNav && floatingNav.classList.contains('active')) {
                    floatingNav.classList.remove('active');
                }
            });

            function adjustHeaderLayout() {
                if (window.innerWidth <= 768) {
                    mainNav.style.display = 'none';
                } else {
                    mainNav.style.display = 'flex';
                    floatingNav.classList.remove('active');
                }
            }

            adjustHeaderLayout();
            window.addEventListener('resize', adjustHeaderLayout);

            // --- Tool-Specific UI and Logic Definitions ---
            const tools = {
                merge: {
                    title: "Merge PDF Files",
                    description: "Combine multiple PDF files into a single document.",
                    html: `
                        <div class="drag-drop-area" id="merge-drag-drop-area">
                            <p>Drag & drop your PDF files here</p>
                            <input type="file" id="merge-file-input" multiple accept="application/pdf" hidden>
                            <button class="browse-button" id="merge-browse-files-btn">Or Browse Files</button>
                        </div>
                        <ul id="merge-uploaded-files-list" class="uploaded-files-list"></ul>
                        <div class="tool-buttons-container">
                            <button class="primary-button" id="merge-pdfs-btn" disabled>Merge PDFs</button>
                        </div>
                        <div id="loader" class="loader"></div>
                    `,
                    init: function() {
                        let uploadedPdfs = []; // Local to merge tool instance

                        const dragDropArea = document.getElementById('merge-drag-drop-area');
                        const fileInput = document.getElementById('merge-file-input');
                        const browseFilesBtn = document.getElementById('merge-browse-files-btn');
                        const uploadedFilesList = document.getElementById('merge-uploaded-files-list');
                        const mergePdfsBtn = document.getElementById('merge-pdfs-btn');

                        // Helper for merge button state
                        const updateMergeButtonState = () => {
                            mergePdfsBtn.disabled = uploadedPdfs.length < 2;
                        };

                        // Render uploaded files list (with reordering)
                        const renderUploadedFiles = () => {
                            uploadedFilesList.innerHTML = '';
                            if (uploadedPdfs.length === 0) {
                                uploadedFilesList.style.display = 'none';
                                updateMergeButtonState();
                                return;
                            }
                            uploadedFilesList.style.display = 'block';

                            uploadedPdfs.forEach((file, index) => {
                                const listItem = document.createElement('li');
                                listItem.className = 'file-item';
                                listItem.draggable = true;
                                listItem.dataset.index = index;

                                listItem.innerHTML = `
                                    <div class="file-info">
                                        <span class="name">${file.name}</span>
                                        <span class="size">${formatBytes(file.size)}</span>
                                    </div>
                                    <button class="remove-file-btn">Remove</button>
                                `;
                                uploadedFilesList.appendChild(listItem);

                                listItem.querySelector('.remove-file-btn').addEventListener('click', () => {
                                    removeFile(index);
                                });
                            });
                            updateMergeButtonState();
                            addDragDropListeners(); // Re-attach drag/drop listeners after re-render
                        };

                        // Add files
                        const addFiles = (files) => {
                            let validFilesAdded = 0;
                            for (const file of files) {
                                if (file.type === 'application/pdf') {
                                    uploadedPdfs.push(file);
                                    validFilesAdded++;
                                } else {
                                    showMessage(`Skipped non-PDF file: ${file.name}`, 'warning');
                                }
                            }
                            if (validFilesAdded > 0) {
                                renderUploadedFiles();
                                showMessage(`Added ${validFilesAdded} PDF(s).`, 'info');
                            }
                        };

                        // Remove file
                        const removeFile = (indexToRemove) => {
                            uploadedPdfs.splice(indexToRemove, 1);
                            renderUploadedFiles();
                            showMessage('File removed.', 'info');
                        };

                        // Drag and Drop Reordering Logic
                        let dragSrcEl = null;

                        function handleDragStart(e) {
                            dragSrcEl = this;
                            e.dataTransfer.effectAllowed = 'move';
                            e.dataTransfer.setData('text/html', this.innerHTML);
                            this.classList.add('dragging');
                        }

                        function handleDragOver(e) {
                            e.preventDefault();
                            e.dataTransfer.dropEffect = 'move';
                            if (this !== dragSrcEl) {
                                this.style.borderTop = '2px solid var(--primary-color)';
                            }
                        }

                        function handleDragLeave(e) {
                            this.style.borderTop = '';
                        }

                        function handleDrop(e) {
                            e.stopPropagation();
                            this.style.borderTop = '';

                            if (dragSrcEl !== this) {
                                const fromIndex = parseInt(dragSrcEl.dataset.index);
                                const toIndex = parseInt(this.dataset.index);

                                const [movedItem] = uploadedPdfs.splice(fromIndex, 1);
                                uploadedPdfs.splice(toIndex, 0, movedItem);

                                renderUploadedFiles();
                            }
                        }

                        function handleDragEnd(e) {
                            this.classList.remove('dragging');
                            this.style.borderTop = '';
                        }

                        function addDragDropListeners() {
                            const items = uploadedFilesList.querySelectorAll('.file-item');
                            items.forEach(item => {
                                item.removeEventListener('dragstart', handleDragStart); // Prevent multiple listeners
                                item.removeEventListener('dragover', handleDragOver);
                                item.removeEventListener('dragleave', handleDragLeave);
                                item.removeEventListener('drop', handleDrop);
                                item.removeEventListener('dragend', handleDragEnd);

                                item.addEventListener('dragstart', handleDragStart);
                                item.addEventListener('dragover', handleDragOver);
                                item.addEventListener('dragleave', handleDragLeave);
                                item.addEventListener('drop', handleDrop);
                                item.addEventListener('dragend', handleDragEnd);
                            });
                        }

                        // Event Listeners for Merge Tool
                        dragDropArea.addEventListener('dragover', (e) => {
                            e.preventDefault();
                            dragDropArea.classList.add('dragover');
                        });
                        dragDropArea.addEventListener('dragleave', () => {
                            dragDropArea.classList.remove('dragover');
                        });
                        dragDropArea.addEventListener('drop', (e) => {
                            e.preventDefault();
                            dragDropArea.classList.remove('dragover');
                            addFiles(e.dataTransfer.files);
                        });
                        browseFilesBtn.addEventListener('click', () => fileInput.click());
                        fileInput.addEventListener('change', (e) => addFiles(e.target.files));

                        mergePdfsBtn.addEventListener('click', async () => {
                            if (uploadedPdfs.length < 2) {
                                showMessage('Please upload at least two PDF files to merge.', 'error');
                                return;
                            }

                            showLoader(true);
                            mergePdfsBtn.disabled = true;
                            mergePdfsBtn.textContent = 'Merging...';
                            showMessage('Merging PDFs...', 'info');

                            const formData = new FormData();
                            uploadedPdfs.forEach(file => {
                                formData.append('files', file);
                            });

                            try {
                                const response = await fetch('https://utilitybackend-82dj.onrender.com/pdf/merge', {
                                    method: 'POST',
                                    body: formData,
                                });

                                if (!response.ok) {
                                    const errorData = await response.json();
                                    throw new Error(errorData.detail || 'Failed to merge PDFs.');
                                }

                                const blob = await response.blob();
                                showResults(blob, 'merged_document.pdf');
                                showMessage('PDFs merged successfully!', 'success');
                                uploadedPdfs = []; // Clear files after successful merge
                            } catch (error) {
                                console.error('PDF merge error:', error);
                                showMessage(`Error: ${error.message}`, 'error');
                            } finally {
                                showLoader(false);
                                mergePdfsBtn.disabled = false;
                                mergePdfsBtn.textContent = 'Merge PDFs';
                            }
                        });

                        renderUploadedFiles(); // Initial render for empty list
                    }
                },
                split: {
                    title: "Split PDF by Page Range",
                    description: "Extract specific pages or ranges from a PDF.",
                    html: `
                        <div class="drag-drop-area" id="split-drag-drop-area">
                            <p>Drag & drop your PDF file here</p>
                            <input type="file" id="split-file-input" accept="application/pdf" hidden>
                            <button class="browse-button" id="split-browse-files-btn">Or Browse File</button>
                        </div>
                        <div id="split-file-preview" style="display:none;">
                            <p>Selected File: <span id="split-file-name"></span></p>
                            <label for="page-range">Page Range (e.g., 1-5, 8, 10-12):</label>
                            <input type="text" id="page-range" placeholder="e.g., 1-5, 8, 10-12" style="width: 100%; padding: 10px; margin-top: 10px; border-radius: 8px; border: 1px solid var(--border-color); background-color: var(--bg-color); color: var(--text-color);">
                            <button class="primary-button" id="split-pdf-btn" style="margin-top: 20px;">Split PDF</button>
                            <button class="remove-file-btn" id="split-remove-file-btn" style="margin-top: 20px;">Remove File</button>
                        </div>
                        <div id="loader" class="loader"></div>
                    `,
                    init: function() {
                        const dragDropArea = document.getElementById('split-drag-drop-area');
                        const fileInput = document.getElementById('split-file-input');
                        const browseFilesBtn = document.getElementById('split-browse-files-btn');
                        const filePreview = document.getElementById('split-file-preview');
                        const fileNameSpan = document.getElementById('split-file-name');
                        const pageRangeInput = document.getElementById('page-range');
                        const splitPdfBtn = document.getElementById('split-pdf-btn');
                        const removeFileBtn = document.getElementById('split-remove-file-btn');
                        let selectedFile = null;

                        const resetSplitUI = () => {
                            selectedFile = null;
                            fileInput.value = '';
                            filePreview.style.display = 'none';
                            dragDropArea.style.display = 'block';
                            pageRangeInput.value = '';
                            showLoader(false);
                            showMessage('');
                        };

                        const handleFile = (file) => {
                            if (file.type !== 'application/pdf') {
                                showMessage('Please upload a PDF file.', 'error');
                                resetSplitUI();
                                return;
                            }
                            selectedFile = file;
                            fileNameSpan.textContent = file.name;
                            dragDropArea.style.display = 'none';
                            filePreview.style.display = 'block';
                            showMessage(`File selected: ${file.name}`, 'info');
                        };

                        dragDropArea.addEventListener('dragover', (e) => { e.preventDefault(); dragDropArea.classList.add('dragover'); });
                        dragDropArea.addEventListener('dragleave', () => { dragDropArea.classList.remove('dragover'); });
                        dragDropArea.addEventListener('drop', (e) => { e.preventDefault(); dragDropArea.classList.remove('dragover'); handleFile(e.dataTransfer.files[0]); });
                        browseFilesBtn.addEventListener('click', () => fileInput.click());
                        fileInput.addEventListener('change', (e) => handleFile(e.target.files[0]));
                        removeFileBtn.addEventListener('click', resetSplitUI);

                        splitPdfBtn.addEventListener('click', async () => {
                            if (!selectedFile) { showMessage('Please upload a PDF first.', 'error'); return; }
                            const pageRange = pageRangeInput.value.trim();
                            if (!pageRange) { showMessage('Please enter page ranges to split.', 'error'); return; }

                            showLoader(true);
                            splitPdfBtn.disabled = true;
                            showMessage('Splitting PDF...', 'info');

                            const formData = new FormData();
                            formData.append('file', selectedFile);
                            formData.append('page_range', pageRange);

                            try {
                                const response = await fetch('https://utilitybackend-82dj.onrender.com/pdf/split', { // Placeholder
                                    method: 'POST', body: formData,
                                });
                                if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.detail || 'Failed to split PDF.'); }
                                const blob = await response.blob();
                                showResults(blob, `split_${selectedFile.name}`);
                                showMessage('PDF split successfully!', 'success');
                            } catch (error) {
                                console.error('PDF split error:', error);
                                showMessage(`Error: ${error.message}`, 'error');
                            } finally {
                                showLoader(false);
                                splitPdfBtn.disabled = false;
                            }
                        });
                        resetSplitUI(); // Initial state
                    }
                },
                compress: {
                    title: "Compress PDF",
                    description: "Reduce the file size of your PDF document.",
                    html: `
                        <div class="drag-drop-area" id="compress-drag-drop-area">
                            <p>Drag & drop your PDF file here</p>
                            <input type="file" id="compress-file-input" accept="application/pdf" hidden>
                            <button class="browse-button" id="compress-browse-files-btn">Or Browse File</button>
                        </div>
                        <div id="compress-file-preview" style="display:none;">
                            <p>Selected File: <span id="compress-file-name"></span></p>
                            <label for="compression-level" style="display:block; margin-top:15px;">Compression Level:</label>
                            <select id="compression-level" style="width: 100%; padding: 10px; margin-top: 10px; border-radius: 8px; border: 1px solid var(--border-color); background-color: var(--bg-color); color: var(--text-color);">
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                            </select>
                            <button class="primary-button" id="compress-pdf-btn" style="margin-top: 20px;">Compress PDF</button>
                            <button class="remove-file-btn" id="compress-remove-file-btn" style="margin-top: 20px;">Remove File</button>
                        </div>
                        <div id="loader" class="loader"></div>
                    `,
                    init: function() {
                        const dragDropArea = document.getElementById('compress-drag-drop-area');
                        const fileInput = document.getElementById('compress-file-input');
                        const browseFilesBtn = document.getElementById('compress-browse-files-btn');
                        const filePreview = document.getElementById('compress-file-preview');
                        const fileNameSpan = document.getElementById('compress-file-name');
                        const compressionLevelSelect = document.getElementById('compression-level');
                        const compressPdfBtn = document.getElementById('compress-pdf-btn');
                        const removeFileBtn = document.getElementById('compress-remove-file-btn');
                        let selectedFile = null;

                        const resetCompressUI = () => {
                            selectedFile = null;
                            fileInput.value = '';
                            filePreview.style.display = 'none';
                            dragDropArea.style.display = 'block';
                            compressionLevelSelect.value = 'medium';
                            showLoader(false);
                            showMessage('');
                        };

                        const handleFile = (file) => {
                            if (file.type !== 'application/pdf') { showMessage('Please upload a PDF file.', 'error'); resetCompressUI(); return; }
                            selectedFile = file;
                            fileNameSpan.textContent = file.name;
                            dragDropArea.style.display = 'none';
                            filePreview.style.display = 'block';
                            showMessage(`File selected: ${file.name}`, 'info');
                        };

                        dragDropArea.addEventListener('dragover', (e) => { e.preventDefault(); dragDropArea.classList.add('dragover'); });
                        dragDropArea.addEventListener('dragleave', () => { dragDropArea.classList.remove('dragover'); });
                        dragDropArea.addEventListener('drop', (e) => { e.preventDefault(); dragDropArea.classList.remove('dragover'); handleFile(e.dataTransfer.files[0]); });
                        browseFilesBtn.addEventListener('click', () => fileInput.click());
                        fileInput.addEventListener('change', (e) => handleFile(e.target.files[0]));
                        removeFileBtn.addEventListener('click', resetCompressUI);

                        compressPdfBtn.addEventListener('click', async () => {
                            if (!selectedFile) { showMessage('Please upload a PDF first.', 'error'); return; }
                            const compressionLevel = compressionLevelSelect.value;

                            showLoader(true);
                            compressPdfBtn.disabled = true;
                            showMessage('Compressing PDF...', 'info');

                            const formData = new FormData();
                            formData.append('file', selectedFile);
                            formData.append('level', compressionLevel);

                            try {
                                const response = await fetch('https://utilitybackend-82dj.onrender.com/pdf/compress', { // Placeholder
                                    method: 'POST', body: formData,
                                });
                                if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.detail || 'Failed to compress PDF.'); }
                                const blob = await response.blob();
                                showResults(blob, `compressed_${selectedFile.name}`);
                                showMessage('PDF compressed successfully!', 'success');
                            } catch (error) {
                                console.error('PDF compress error:', error);
                                showMessage(`Error: ${error.message}`, 'error');
                            } finally {
                                showLoader(false);
                                compressPdfBtn.disabled = false;
                            }
                        });
                        resetCompressUI();
                    }
                },
                img2pdf: {
                    title: "Convert Images to PDF",
                    description: "Convert multiple image files into a single PDF document.",
                    html: `
                        <div class="drag-drop-area" id="img2pdf-drag-drop-area">
                            <p>Drag & drop your image files here</p>
                            <input type="file" id="img2pdf-file-input" multiple accept="image/*" hidden>
                            <button class="browse-button" id="img2pdf-browse-files-btn">Or Browse Files</button>
                        </div>
                        <ul id="img2pdf-uploaded-files-list" class="uploaded-files-list"></ul>
                        <div class="tool-buttons-container">
                            <button class="primary-button" id="convert-img2pdf-btn" disabled>Convert to PDF</button>
                        </div>
                        <div id="loader" class="loader"></div>
                    `,
                    init: function() {
                        let uploadedImages = [];
                        const dragDropArea = document.getElementById('img2pdf-drag-drop-area');
                        const fileInput = document.getElementById('img2pdf-file-input');
                        const browseFilesBtn = document.getElementById('img2pdf-browse-files-btn');
                        const uploadedFilesList = document.getElementById('img2pdf-uploaded-files-list');
                        const convertBtn = document.getElementById('convert-img2pdf-btn');

                        const updateButtonState = () => { convertBtn.disabled = uploadedImages.length === 0; };
                        const renderFiles = () => {
                            uploadedFilesList.innerHTML = '';
                            if (uploadedImages.length === 0) { uploadedFilesList.style.display = 'none'; updateButtonState(); return; }
                            uploadedFilesList.style.display = 'block';
                            uploadedImages.forEach((file, index) => {
                                const listItem = document.createElement('li');
                                listItem.className = 'file-item';
                                listItem.innerHTML = `<div class="file-info"><span class="name">${file.name}</span><span class="size">${formatBytes(file.size)}</span></div><button class="remove-file-btn">Remove</button>`;
                                uploadedFilesList.appendChild(listItem);
                                listItem.querySelector('.remove-file-btn').addEventListener('click', () => { uploadedImages.splice(index, 1); renderFiles(); });
                            });
                            updateButtonState();
                        };
                        const addFiles = (files) => {
                            let validFilesAdded = 0;
                            for (const file of files) {
                                if (file.type.startsWith('image/')) { uploadedImages.push(file); validFilesAdded++; }
                                else { showMessage(`Skipped non-image file: ${file.name}`, 'warning'); }
                            }
                            if (validFilesAdded > 0) { renderFiles(); showMessage(`Added ${validFilesAdded} image(s).`, 'info'); }
                        };

                        dragDropArea.addEventListener('dragover', (e) => { e.preventDefault(); dragDropArea.classList.add('dragover'); });
                        dragDropArea.addEventListener('dragleave', () => { dragDropArea.classList.remove('dragover'); });
                        dragDropArea.addEventListener('drop', (e) => { e.preventDefault(); dragDropArea.classList.remove('dragover'); addFiles(e.dataTransfer.files); });
                        browseFilesBtn.addEventListener('click', () => fileInput.click());
                        fileInput.addEventListener('change', (e) => addFiles(e.target.files));

                        convertBtn.addEventListener('click', async () => {
                            if (uploadedImages.length === 0) { showMessage('Please upload images first.', 'error'); return; }
                            showLoader(true); convertBtn.disabled = true; showMessage('Converting images to PDF...', 'info');
                            const formData = new FormData();
                            uploadedImages.forEach(file => formData.append('files', file));
                            try {
                                const response = await fetch('https://utilitybackend-82dj.onrender.com/pdf/image-to-pdf', { method: 'POST', body: formData, }); // Placeholder
                                if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.detail || 'Failed to convert images to PDF.'); }
                                const blob = await response.blob();
                                showResults(blob, 'converted_images.pdf');
                                showMessage('Images converted to PDF successfully!', 'success');
                                uploadedImages = [];
                            } catch (error) {
                                console.error('Image to PDF error:', error); showMessage(`Error: ${error.message}`, 'error');
                            } finally { showLoader(false); convertBtn.disabled = false; }
                        });
                        renderFiles();
                    }
                },
                pdf2img: {
                    title: "Convert PDF to Images",
                    description: "Convert each page of a PDF into separate image files.",
                    html: `
                        <div class="drag-drop-area" id="pdf2img-drag-drop-area">
                            <p>Drag & drop your PDF file here</p>
                            <input type="file" id="pdf2img-file-input" accept="application/pdf" hidden>
                            <button class="browse-button" id="pdf2img-browse-files-btn">Or Browse File</button>
                        </div>
                        <div id="pdf2img-file-preview" style="display:none;">
                            <p>Selected File: <span id="pdf2img-file-name"></span></p>
                            <label for="image-format" style="display:block; margin-top:15px;">Output Image Format:</label>
                            <select id="image-format" style="width: 100%; padding: 10px; margin-top: 10px; border-radius: 8px; border: 1px solid var(--border-color); background-color: var(--bg-color); color: var(--text-color);">
                                <option value="png">PNG</option>
                                <option value="jpeg">JPEG</option>
                                <option value="webp">WEBP</option>
                            </select>
                            <button class="primary-button" id="convert-pdf2img-btn" style="margin-top: 20px;">Convert to Images</button>
                            <button class="remove-file-btn" id="pdf2img-remove-file-btn" style="margin-top: 20px;">Remove File</button>
                        </div>
                        <div id="loader" class="loader"></div>
                    `,
                    init: function() {
                        const dragDropArea = document.getElementById('pdf2img-drag-drop-area');
                        const fileInput = document.getElementById('pdf2img-file-input');
                        const browseFilesBtn = document.getElementById('pdf2img-browse-files-btn');
                        const filePreview = document.getElementById('pdf2img-file-preview');
                        const fileNameSpan = document.getElementById('pdf2img-file-name');
                        const imageFormatSelect = document.getElementById('image-format');
                        const convertBtn = document.getElementById('convert-pdf2img-btn');
                        const removeFileBtn = document.getElementById('pdf2img-remove-file-btn');
                        let selectedFile = null;

                        const resetUI = () => { selectedFile = null; fileInput.value = ''; filePreview.style.display = 'none'; dragDropArea.style.display = 'block'; imageFormatSelect.value = 'png'; showLoader(false); showMessage(''); };
                        const handleFile = (file) => {
                            if (file.type !== 'application/pdf') { showMessage('Please upload a PDF file.', 'error'); resetUI(); return; }
                            selectedFile = file; fileNameSpan.textContent = file.name; dragDropArea.style.display = 'none'; filePreview.style.display = 'block'; showMessage(`File selected: ${file.name}`, 'info');
                        };

                        dragDropArea.addEventListener('dragover', (e) => { e.preventDefault(); dragDropArea.classList.add('dragover'); });
                        dragDropArea.addEventListener('dragleave', () => { dragDropArea.classList.remove('dragover'); });
                        dragDropArea.addEventListener('drop', (e) => { e.preventDefault(); dragDropArea.classList.remove('dragover'); handleFile(e.dataTransfer.files[0]); });
                        browseFilesBtn.addEventListener('click', () => fileInput.click());
                        fileInput.addEventListener('change', (e) => handleFile(e.target.files[0]));
                        removeFileBtn.addEventListener('click', resetUI);

                        convertBtn.addEventListener('click', async () => {
                            if (!selectedFile) { showMessage('Please upload a PDF first.', 'error'); return; }
                            const format = imageFormatSelect.value;
                            showLoader(true); convertBtn.disabled = true; showMessage('Converting PDF to images...', 'info');
                            const formData = new FormData();
                            formData.append('file', selectedFile);
                            formData.append('format', format);
                            try {
                                const response = await fetch('https://utilitybackend-82dj.onrender.com/pdf/pdf2img', { method: 'POST', body: formData, }); // Placeholder
                                if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.detail || 'Failed to convert PDF to images.'); }
                                const blob = await response.blob();
                                // Assuming backend returns a zip file for multiple images
                                showResults(blob, `converted_images.zip`, 'application/zip');
                                showMessage('PDF converted to images successfully!', 'success');
                            } catch (error) {
                                console.error('PDF to Images error:', error); showMessage(`Error: ${error.message}`, 'error');
                            } finally { showLoader(false); convertBtn.disabled = false; }
                        });
                        resetUI();
                    }
                },
            };

            // --- Main Tool Selector Logic ---
            pdfToolSelector.addEventListener('change', (event) => {
                const selectedTool = event.target.value;
                if (selectedTool && tools[selectedTool]) {
                    toolSelectorContainer.style.display = 'none'; // Hide tool selector
                    toolUiContainer.innerHTML = `
                        <h2>${tools[selectedTool].title}</h2>
                        <p>${tools[selectedTool].description}</p>
                        ${tools[selectedTool].html}
                        <button class="primary-button" id="back-to-selector-btn" style="margin-top: 30px;">Back to Tools</button>
                    `;
                    document.getElementById('back-to-selector-btn').addEventListener('click', resetToolUI);
                    if (tools[selectedTool].init) {
                        tools[selectedTool].init(); // Initialize tool-specific JS
                    }
                } else {
                    resetToolUI(); // Reset if no tool or invalid tool selected
                }
            });

            // Initial state: ensure tool selector is visible
            resetToolUI();
        });
    </script>
</body>
</html>
